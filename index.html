<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TAREK </title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-color: #4A00E0;
            --secondary-color: #8E2DE2;
            --accent-color: #FF416C;
            --success-color: #00D2A0;
            --warning-color: #FFA62E;
            --light-color: #F8F9FF;
            --dark-color: #1A1A2E;
            --card-bg: #FFFFFF;
            --gradient-primary: linear-gradient(135deg, #4A00E0 0%, #8E2DE2 100%);
            --gradient-secondary: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%);
            --gradient-success: linear-gradient(135deg, #00D2A0 0%, #00B894 100%);
            --gradient-warning: linear-gradient(135deg, #FFA62E 0%, #FF9A3D 100%);
            --gradient-dark: linear-gradient(135deg, #1A1A2E 0%, #16213E 100%);
            --shadow-light: 0 10px 30px rgba(74, 0, 224, 0.08);
            --shadow-medium: 0 15px 35px rgba(74, 0, 224, 0.12);
            --shadow-heavy: 0 20px 50px rgba(74, 0, 224, 0.15);
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        body {
            background: linear-gradient(135deg, #F8F9FF 0%, #EFF2FF 100%);
            color: #333;
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
            position: relative;
            overflow-x: hidden;
        }
        
        /* خلفية متحركة */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .bg-circle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(74, 0, 224, 0.05) 0%, rgba(142, 45, 226, 0.05) 100%);
            animation: float 20s infinite ease-in-out;
        }
        
        .bg-circle:nth-child(1) {
            width: 300px;
            height: 300px;
            top: -100px;
            right: -100px;
            animation-delay: 0s;
        }
        
        .bg-circle:nth-child(2) {
            width: 200px;
            height: 200px;
            bottom: -50px;
            left: -50px;
            animation-delay: 5s;
        }
        
        .bg-circle:nth-child(3) {
            width: 150px;
            height: 150px;
            top: 30%;
            left: 10%;
            animation-delay: 10s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        /* ترويسة جديدة بتصميم عصري */
        .main-header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 30px;
            box-shadow: var(--shadow-heavy);
            position: relative;
            overflow: hidden;
            border-bottom: 5px solid var(--accent-color);
            animation: slideDown 0.8s ease-out;
        }
        
        @keyframes slideDown {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 2;
        }
        
        @media (min-width: 768px) {
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                text-align: right;
            }
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-circle {
            width: 80px;
            height: 80px;
            background: var(--gradient-secondary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: pulse 3s infinite ease-in-out;
            transition: var(--transition);
        }
        
        .logo-circle:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 15px 35px rgba(255, 65, 108, 0.3);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .logo-text {
            text-align: right;
        }
        
        .logo-text h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            color: white;
            font-weight: 800;
            background: linear-gradient(135deg, #FFFFFF 0%, #E0E0FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textGlow 3s infinite alternate;
        }
        
        @keyframes textGlow {
            0% { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3)); }
            100% { filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.6)); }
        }
        
        .logo-text p {
            font-size: 1.1rem;
            opacity: 0.9;
            color: #E0E0FF;
        }
        
        .header-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }
        
        @media (min-width: 768px) {
            .header-info {
                align-items: flex-end;
            }
        }
        
        .system-name {
            font-size: 2rem;
            font-weight: 700;
            color: #FFEAA7;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            position: relative;
            padding-bottom: 10px;
        }
        
        .system-name::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 60%;
            height: 3px;
            background: var(--gradient-secondary);
            border-radius: 3px;
            animation: widthPulse 3s infinite;
        }
        
        @keyframes widthPulse {
            0%, 100% { width: 60%; }
            50% { width: 80%; }
        }
        
        .system-description {
            font-size: 1.2rem;
            color: #D6C6FF;
            max-width: 400px;
        }
        
        /* تأثيرات تزيينية للترويسة */
        .header-decoration {
            position: absolute;
            top: -50px;
            left: -50px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
            animation: rotate 30s linear infinite;
        }
        
        .header-decoration:nth-child(2) {
            top: auto;
            bottom: -80px;
            right: -80px;
            left: auto;
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(255, 65, 108, 0.1) 1%, transparent 70%);
            animation: rotateReverse 40s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes rotateReverse {
            0% { transform: rotate(360deg); }
            100% { transform: rotate(0deg); }
        }
        
        /* تبويبات جديدة بتصميم عصري */
        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
            overflow: hidden;
            animation: fadeIn 0.6s ease-out 0.3s both;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .tab {
            flex: 1;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 700;
            color: #666;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            z-index: 1;
            transform: translateY(100%);
            transition: var(--transition);
            opacity: 0.1;
        }
        
        .tab:hover {
            color: var(--primary-color);
            transform: translateY(-3px);
        }
        
        .tab:hover::before {
            transform: translateY(0);
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--accent-color);
            background-color: rgba(74, 0, 224, 0.05);
            transform: translateY(0);
        }
        
        .tab.active::before {
            transform: translateY(0);
        }
        
        .tab-icon {
            margin-left: 10px;
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .tab:hover .tab-icon {
            transform: scale(1.2);
        }
        
        .tab.active .tab-icon {
            color: var(--accent-color);
            transform: scale(1.2);
        }
        
        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .form-section, .report-section, .manage-section {
            background-color: var(--card-bg);
            padding: 25px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            margin-bottom: 25px;
            border: 1px solid rgba(74, 0, 224, 0.1);
            animation: fadeIn 0.6s ease-out 0.4s both;
            transition: var(--transition);
        }
        
        .form-section:hover, .report-section:hover, .manage-section:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-5px);
        }
        
        h2 {
            color: var(--dark-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(74, 0, 224, 0.1);
            font-size: 1.8rem;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            0% { opacity: 0; transform: translateX(30px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 100px;
            height: 3px;
            background: var(--gradient-primary);
            border-radius: 3px;
            animation: widthGrow 2s ease-out;
        }
        
        @keyframes widthGrow {
            0% { width: 0; }
            100% { width: 100px; }
        }
        
        h2 span {
            font-size: 1rem;
            color: #666;
            font-weight: normal;
        }
        
        .form-group {
            margin-bottom: 25px;
            position: relative;
            animation: fadeIn 0.5s ease-out;
            animation-fill-mode: both;
        }
        
        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }
        .form-group:nth-child(5) { animation-delay: 0.5s; }
        .form-group:nth-child(6) { animation-delay: 0.6s; }
        .form-group:nth-child(7) { animation-delay: 0.7s; }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--dark-color);
            font-size: 1.1rem;
            transition: var(--transition);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 16px 18px;
            border: 2px solid #E0E0FF;
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background-color: #F8F9FF;
            -webkit-appearance: none;
            appearance: none;
            color: var(--dark-color);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 4px rgba(142, 45, 226, 0.2);
            background-color: white;
            transform: translateY(-2px);
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }
        
        @media (min-width: 480px) {
            .radio-group {
                flex-direction: row;
            }
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-radius: var(--border-radius-sm);
            background-color: #F8F9FF;
            transition: var(--transition);
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .radio-option:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-light);
            border-color: #E0E0FF;
        }
        
        /* تمييز نوع العملية النشط */
        .radio-option.active-ticket {
            background: linear-gradient(135deg, rgba(0, 210, 160, 0.1) 0%, rgba(0, 184, 148, 0.05) 100%);
            border: 2px solid var(--success-color);
            box-shadow: 0 0 25px rgba(0, 210, 160, 0.2);
            transform: translateY(-5px);
        }
        
        .radio-option.active-fine {
            background: linear-gradient(135deg, rgba(255, 65, 108, 0.1) 0%, rgba(255, 75, 43, 0.05) 100%);
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 25px rgba(255, 65, 108, 0.2);
            transform: translateY(-5px);
        }
        
        .radio-option.active-payment {
            background: linear-gradient(135deg, rgba(142, 45, 226, 0.1) 0%, rgba(74, 0, 224, 0.05) 100%);
            border: 2px solid var(--secondary-color);
            box-shadow: 0 0 25px rgba(142, 45, 226, 0.2);
            transform: translateY(-5px);
        }
        
        .radio-option::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8) 1%, transparent 20%);
            z-index: 1;
            opacity: 0;
            transition: var(--transition);
        }
        
        .radio-option.active-ticket::before,
        .radio-option.active-fine::before,
        .radio-option.active-payment::before {
            opacity: 1;
        }
        
        .radio-option.active-ticket label {
            color: var(--success-color);
            font-weight: 800;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        
        .radio-option.active-fine label {
            color: var(--accent-color);
            font-weight: 800;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        
        .radio-option.active-payment label {
            color: var(--secondary-color);
            font-weight: 800;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        
        /* أيقونات مضيئة */
        .radio-icon {
            font-size: 1.5rem;
            transition: var(--transition);
            z-index: 2;
        }
        
        .active-ticket .radio-icon {
            color: var(--success-color);
            text-shadow: 0 0 15px rgba(0, 210, 160, 0.6);
            transform: scale(1.3);
            animation: pulse 2s infinite;
        }
        
        .active-fine .radio-icon {
            color: var(--accent-color);
            text-shadow: 0 0 15px rgba(255, 65, 108, 0.6);
            transform: scale(1.3);
            animation: pulse 2s infinite;
        }
        
        .active-payment .radio-icon {
            color: var(--secondary-color);
            text-shadow: 0 0 15px rgba(142, 45, 226, 0.6);
            transform: scale(1.3);
            animation: pulse 2s infinite;
        }
        
        /* مؤشر نوع العملية */
        .type-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: white;
            color: var(--primary-color);
            font-size: 0.8rem;
            font-weight: bold;
            padding: 5px 12px;
            border-radius: 15px;
            z-index: 3;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            opacity: 0;
            transform: scale(0.8);
            transition: var(--transition);
        }
        
        .active-ticket .type-indicator,
        .active-fine .type-indicator,
        .active-payment .type-indicator {
            opacity: 1;
            transform: scale(1);
        }
        
        .active-ticket .type-indicator {
            background-color: var(--success-color);
            color: white;
        }
        
        .active-fine .type-indicator {
            background-color: var(--accent-color);
            color: white;
        }
        
        .active-payment .type-indicator {
            background-color: var(--secondary-color);
            color: white;
        }
        
        /* توهج النص */
        .radio-text-glow {
            position: relative;
            z-index: 2;
        }
        
        .active-ticket .radio-text-glow {
            animation: textGlowGreen 2s infinite alternate;
        }
        
        .active-fine .radio-text-glow {
            animation: textGlowRed 2s infinite alternate;
        }
        
        .active-payment .radio-text-glow {
            animation: textGlowBlue 2s infinite alternate;
        }
        
        @keyframes textGlowGreen {
            from { text-shadow: 0 0 5px rgba(0, 210, 160, 0.5); }
            to { text-shadow: 0 0 20px rgba(0, 210, 160, 0.8); }
        }
        
        @keyframes textGlowRed {
            from { text-shadow: 0 0 5px rgba(255, 65, 108, 0.5); }
            to { text-shadow: 0 0 20px rgba(255, 65, 108, 0.8); }
        }
        
        @keyframes textGlowBlue {
            from { text-shadow: 0 0 5px rgba(142, 45, 226, 0.5); }
            to { text-shadow: 0 0 20px rgba(142, 45, 226, 0.8); }
        }
        
        .radio-option input {
            width: auto;
            margin-left: 5px;
            position: relative;
            z-index: 2;
            cursor: pointer;
        }
        
        .radio-option label {
            margin-bottom: 0;
            flex: 1;
            position: relative;
            z-index: 2;
            cursor: pointer;
        }
        
        /* أزرار جديدة بتصميم حديث */
        .btn {
            display: inline-block;
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: var(--transition);
            text-align: center;
            width: 100%;
            margin-top: 10px;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(74, 0, 224, 0.2);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 100%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .btn:hover::before {
            transform: translateX(100%);
        }
        
        .btn:hover, .btn:active {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(74, 0, 224, 0.3);
        }
        
        .btn-add {
            background: var(--gradient-success);
            box-shadow: 0 10px 25px rgba(0, 210, 160, 0.2);
        }
        
        .btn-add:hover {
            box-shadow: 0 15px 35px rgba(0, 210, 160, 0.3);
        }
        
        .btn-edit {
            background: var(--gradient-warning);
            box-shadow: 0 10px 25px rgba(255, 166, 46, 0.2);
        }
        
        .btn-edit:hover {
            box-shadow: 0 15px 35px rgba(255, 166, 46, 0.3);
        }
        
        .btn-delete {
            background: var(--gradient-secondary);
            box-shadow: 0 10px 25px rgba(255, 65, 108, 0.2);
        }
        
        .btn-delete:hover {
            box-shadow: 0 15px 35px rgba(255, 65, 108, 0.3);
        }
        
        .btn-print {
            background: var(--gradient-dark);
            width: auto;
            margin: 0;
            padding: 14px 25px;
            font-size: 1rem;
            box-shadow: 0 10px 25px rgba(26, 26, 46, 0.2);
        }
        
        .btn-print:hover {
            box-shadow: 0 15px 35px rgba(26, 26, 46, 0.3);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #6C757D 0%, #495057 100%);
            margin-top: 15px;
            box-shadow: 0 10px 25px rgba(108, 117, 125, 0.2);
        }
        
        .btn-reset:hover {
            box-shadow: 0 15px 35px rgba(108, 117, 125, 0.3);
        }
        
        .btn-add-company {
            background: linear-gradient(135deg, #9D4EDD 0%, #7B2CBF 100%);
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(157, 78, 221, 0.2);
        }
        
        .btn-add-company:hover {
            box-shadow: 0 15px 35px rgba(157, 78, 221, 0.3);
        }
        
        .btn-cancel {
            background: linear-gradient(135deg, #6C757D 0%, #495057 100%);
        }
        
        .btn-save {
            background: var(--gradient-success);
        }
        
        .btn i {
            margin-left: 10px;
            transition: var(--transition);
        }
        
        .btn:hover i {
            transform: scale(1.2);
        }
        
        /* تحسينات للجدول بتصميم عصري */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(74, 0, 224, 0.1);
            max-height: 500px;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }
        
        .table-container:hover {
            box-shadow: var(--shadow-medium);
        }
        
        .manage-table-container {
            max-height: 600px;
        }
        
        /* مؤشر التمرير */
        .scroll-indicator {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(142, 45, 226, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.8rem;
            opacity: 0.7;
            pointer-events: none;
            z-index: 5;
            display: none;
            animation: fadeInOut 3s infinite;
            white-space: nowrap;
            box-shadow: 0 5px 15px rgba(142, 45, 226, 0.3);
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; transform: translateY(-50%) scale(0.95); }
            50% { opacity: 0.9; transform: translateY(-50%) scale(1); }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
            font-size: 0.9rem;
        }
        
        th {
            background: var(--gradient-dark);
            color: white;
            padding: 16px 12px;
            text-align: right;
            font-weight: 700;
            font-size: 1rem;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 3px solid var(--accent-color);
        }
        
        td {
            padding: 14px 12px;
            border-bottom: 1px solid rgba(74, 0, 224, 0.1);
            text-align: right;
            background-color: white;
            transition: var(--transition);
        }
        
        tr:nth-child(even) td {
            background-color: #F8F9FF;
        }
        
        tr:hover td {
            background-color: rgba(74, 0, 224, 0.05);
            transform: scale(1.005);
            box-shadow: 0 5px 15px rgba(74, 0, 224, 0.1);
        }
        
        .transaction-type {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            white-space: nowrap;
            transition: var(--transition);
        }
        
        .transaction-type:hover {
            transform: scale(1.05);
        }
        
        .transaction-ticket {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 210, 160, 0.2);
        }
        
        .transaction-fine {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.2);
        }
        
        .transaction-payment {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 5px 15px rgba(74, 0, 224, 0.2);
        }
        
        .transaction-initial {
            background: var(--gradient-warning);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 166, 46, 0.2);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 10px 16px;
            border-radius: var(--border-radius-sm);
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 700;
            transition: var(--transition);
            color: white;
            white-space: nowrap;
            touch-action: manipulation;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn-edit {
            background: var(--gradient-warning);
        }
        
        .action-btn-delete {
            background: var(--gradient-secondary);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        /* ملخص بتصميم عصري */
        .summary-below-table {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #F0F4FF 0%, #E8EDFF 100%);
            border-radius: var(--border-radius);
            border: 2px solid var(--secondary-color);
            text-align: center;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }
        
        .summary-below-table:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        
        .summary-below-table h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid rgba(142, 45, 226, 0.2);
            padding-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .summary-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .summary-items {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .summary-item {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .summary-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            background: var(--gradient-primary);
            transition: var(--transition);
        }
        
        .summary-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        
        .summary-item:hover::before {
            width: 10px;
        }
        
        .summary-item h4 {
            font-size: 1rem;
            color: #666;
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        .summary-item .value {
            font-size: 1.8rem;
            font-weight: 800;
            transition: var(--transition);
        }
        
        .summary-item:hover .value {
            transform: scale(1.05);
        }
        
        .summary-item .value.positive {
            color: var(--success-color);
        }
        
        .summary-item .value.negative {
            color: var(--accent-color);
        }
        
        .company-selector {
            margin-bottom: 25px;
        }
        
        .company-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #F8F9FF 0%, #F0F4FF 100%);
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border-right: 5px solid var(--secondary-color);
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }
        
        .company-info:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        
        @media (min-width: 480px) {
            .company-info {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .company-info h3 {
            color: var(--primary-color);
            font-size: 1.6rem;
            margin: 0;
            text-align: center;
        }
        
        @media (min-width: 480px) {
            .company-info h3 {
                text-align: right;
            }
        }
        
        .company-balance {
            font-size: 1.6rem;
            font-weight: 800;
            padding: 12px 20px;
            border-radius: var(--border-radius-sm);
            background-color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: var(--transition);
        }
        
        .company-balance:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .positive-balance {
            color: var(--success-color);
            border-right: 4px solid var(--success-color);
        }
        
        .negative-balance {
            color: var(--accent-color);
            border-right: 4px solid var(--accent-color);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 2px solid rgba(74, 0, 224, 0.1);
            color: #6C757D;
            font-size: 0.9rem;
            padding-bottom: 25px;
            animation: fadeIn 0.8s ease-out 0.6s both;
        }
        
        /* =========================================== */
        /* تحسينات الطباعة الاحترافية */
        /* =========================================== */
        
        @media print {
            body {
                padding: 5mm !important;
                background-color: white !important;
                font-size: 11px !important;
                line-height: 1.3 !important;
                color: black !important;
            }
            
            .no-print, .bg-animation {
                display: none !important;
            }
            
            /* إخفاء جميع العناصر غير المرغوبة */
            .form-section, .summary-below-table, .manage-section, .tabs,
            .scroll-indicator, .company-info, .main-header, footer,
            .report-header-actions, .company-selector-report {
                display: none !important;
            }
            
            /* تصميم الصفحة للطباعة */
            .print-page {
                display: block !important;
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                page-break-inside: avoid;
            }
            
            /* ترويسة الطباعة الجميلة */
            .print-header {
                display: flex !important;
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 10px 0;
                margin-bottom: 15px;
                border-bottom: 2px solid #4A00E0;
                page-break-after: avoid;
            }
            
            .print-logo {
                display: flex !important;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-bottom: 8px;
            }
            
            .print-logo-icon {
                width: 50px;
                height: 50px;
                background: var(--gradient-secondary);
                color: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                font-weight: bold;
            }
            
            .print-title {
                text-align: center;
                margin: 0;
            }
            
            .print-title h1 {
                font-size: 18px !important;
                color: #4A00E0 !important;
                margin-bottom: 3px;
                font-weight: bold;
                text-shadow: none !important;
            }
            
            .print-title p {
                font-size: 12px !important;
                color: #666 !important;
                margin: 0;
            }
            
            /* معلومات الشركة في الطباعة */
            .print-company-info {
                display: block !important;
                text-align: center;
                margin: 12px 0;
                padding: 10px;
                background: #f8f9fa;
                border-radius: 5px;
                border: 1px solid #dee2e6;
                page-break-after: avoid;
            }
            
            .print-company-name {
                font-size: 16px !important;
                color: #1A1A2E !important;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-company-details {
                font-size: 12px !important;
                color: #666 !important;
                margin: 3px 0;
            }
            
            /* جدول الطباعة */
            .print-table-container {
                margin: 15px 0;
                border: 1px solid #dee2e6;
                border-radius: 6px;
                overflow: hidden;
            }
            
            #print-transactions-table {
                width: 100% !important;
                border-collapse: collapse !important;
                font-size: 10px !important;
                table-layout: fixed !important;
            }
            
            #print-transactions-table th {
                background: var(--gradient-dark) !important;
                color: white !important;
                padding: 6px 4px !important;
                text-align: center !important;
                font-weight: bold !important;
                border: 1px solid #1A1A2E !important;
                font-size: 10px !important;
            }
            
            #print-transactions-table td {
                padding: 5px 4px !important;
                border: 1px solid #dee2e6 !important;
                text-align: center !important;
                font-size: 9px !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }
            
            #print-transactions-table tr:nth-child(even) td {
                background-color: #f8f9fa !important;
            }
            
            /* تحسين عرض أنواع العمليات عند الطباعة */
            .transaction-type {
                padding: 2px 5px !important;
                font-size: 8px !important;
                font-weight: bold !important;
                border-radius: 8px !important;
                display: inline-block !important;
                min-width: 50px !important;
                text-align: center !important;
            }
            
            .transaction-ticket {
                background: var(--gradient-success) !important;
                color: white !important;
                border: 1px solid #00D2A0 !important;
            }
            
            .transaction-fine {
                background: var(--gradient-secondary) !important;
                color: white !important;
                border: 1px solid #FF416C !important;
            }
            
            .transaction-payment {
                background: var(--gradient-primary) !important;
                color: white !important;
                border: 1px solid #8E2DE2 !important;
            }
            
            .transaction-initial {
                background: var(--gradient-warning) !important;
                color: white !important;
                border: 1px solid #FFA62E !important;
            }
            
            /* قسم الرصيد النهائي في الطباعة */
            .print-balance-summary {
                display: block !important;
                margin-top: 15px;
                padding: 10px;
                background: linear-gradient(135deg, #F0F4FF, #E8EDFF);
                border-radius: 6px;
                border: 1px solid #8E2DE2;
                text-align: center;
                page-break-before: avoid;
                page-break-after: avoid;
                font-size: 11px !important;
            }
            
            .print-total-balance {
                font-size: 14px !important;
                font-weight: bold;
                color: #1A1A2E;
                margin-top: 8px;
                padding-top: 8px;
                border-top: 1px solid #8E2DE2;
            }
            
            .positive-balance-print {
                color: #00D2A0 !important;
            }
            
            .negative-balance-print {
                color: #FF416C !important;
            }
            
            .neutral-balance-print {
                color: #1A1A2E !important;
            }
            
            /* تذييل الصفحة في الطباعة */
            .print-footer {
                display: block !important;
                text-align: center;
                margin-top: 20px;
                padding-top: 10px;
                border-top: 1px solid #dee2e6;
                font-size: 9px !important;
                color: #666 !important;
                page-break-before: avoid;
            }
            
            .print-footer p {
                margin: 2px 0;
            }
            
            .print-signature {
                margin-top: 15px;
                padding-top: 10px;
                border-top: 1px dashed #999;
                text-align: center;
            }
            
            .signature-line {
                width: 150px;
                border-bottom: 1px solid #333;
                margin: 15px auto 3px;
                padding-bottom: 10px;
            }
            
            .signature-label {
                font-size: 10px;
                color: #333;
            }
            
            /* تحسينات للطباعة على الهواتف */
            @media (max-width: 768px) and print {
                body {
                    padding: 3mm !important;
                    font-size: 9px !important;
                }
                
                .print-title h1 {
                    font-size: 16px !important;
                }
                
                .print-company-name {
                    font-size: 14px !important;
                }
                
                #print-transactions-table {
                    font-size: 8px !important;
                }
                
                #print-transactions-table th,
                #print-transactions-table td {
                    padding: 4px 2px !important;
                    font-size: 8px !important;
                }
                
                .transaction-type {
                    font-size: 7px !important;
                    padding: 1px 4px !important;
                }
                
                .print-balance-summary {
                    font-size: 9px !important;
                }
            }
            
            /* إخفاء حاوية التمرير */
            .table-container {
                overflow: visible !important;
                max-height: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* إخفاء رسالة عدم وجود بيانات */
            #no-data {
                display: none !important;
            }
            
            /* إخفاء قسم التقرير العادي */
            .report-section {
                box-shadow: none !important;
                padding: 0 !important;
                border: none !important;
                margin: 0 !important;
                background: white !important;
            }
            
            /* ضبط هوامش الصفحة */
            @page {
                margin: 8mm;
                size: auto;
            }
            
            /* منع تقسيم الصفوف بين الصفحات */
            tr {
                page-break-inside: avoid;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        .company-list {
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: var(--border-radius-sm);
            border: 2px solid #E0E0FF;
            padding: 15px;
            background: #F8F9FF;
        }
        
        .company-item {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 18px;
            background: white;
            margin-bottom: 12px;
            border-radius: var(--border-radius-sm);
            border-right: 4px solid var(--secondary-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .company-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        @media (min-width: 480px) {
            .company-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .company-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .company-item-balance {
            font-weight: 800;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            background-color: white;
            font-size: 1rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .company-item:hover .company-item-balance {
            transform: scale(1.05);
        }
        
        .company-item-actions {
            display: flex;
            gap: 10px;
        }
        
        .delete-company {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            flex: 1;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.2);
        }
        
        .delete-company:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 65, 108, 0.3);
        }
        
        /* نافذة إضافة شركة جديدة بتصميم حديث */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 26, 46, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, white, #F8F9FF);
            padding: 30px;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(74, 0, 224, 0.1);
            animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes slideUp {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(74, 0, 224, 0.1);
            padding-bottom: 20px;
        }
        
        .modal-header h3 {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.8rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--accent-color);
            line-height: 1;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            background: rgba(255, 65, 108, 0.1);
            transform: rotate(90deg);
        }
        
        .balance-type {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (min-width: 480px) {
            .balance-type {
                flex-direction: row;
            }
        }
        
        .debit-option, .credit-option {
            flex: 1;
            padding: 25px;
            border: 2px solid #E0E0FF;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .debit-option:hover, .credit-option:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-light);
        }
        
        .debit-option.selected {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, rgba(255, 65, 108, 0.1), rgba(255, 75, 43, 0.05));
            color: var(--accent-color);
            box-shadow: 0 10px 25px rgba(255, 65, 108, 0.15);
        }
        
        .credit-option.selected {
            border-color: var(--success-color);
            background: linear-gradient(135deg, rgba(0, 210, 160, 0.1), rgba(0, 184, 148, 0.05));
            color: var(--success-color);
            box-shadow: 0 10px 25px rgba(0, 210, 160, 0.15);
        }
        
        .balance-explanation {
            margin-top: 20px;
            padding: 18px;
            background: linear-gradient(135deg, #F8F9FF, #F0F4FF);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            color: #555;
            border-right: 4px solid var(--secondary-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .explanation-positive {
            color: var(--success-color);
            font-weight: 800;
        }
        
        .explanation-negative {
            color: var(--accent-color);
            font-weight: 800;
        }
        
        .initial-balance-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid rgba(74, 0, 224, 0.1);
        }
        
        .report-header {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(74, 0, 224, 0.1);
        }
        
        @media (min-width: 480px) {
            .report-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .company-report-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin: 0;
            text-align: center;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @media (min-width: 480px) {
            .company-report-title {
                text-align: right;
            }
        }
        
        .destination-abbr {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background-color: #F0F4FF;
            padding: 5px 10px;
            border-radius: var(--border-radius-sm);
            color: var(--primary-color);
            font-size: 0.9rem;
            border: 1px solid rgba(74, 0, 224, 0.2);
        }
        
        /* تحسينات لزر اختيار الشركة في التقرير */
        .report-header-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        
        @media (min-width: 768px) {
            .report-header-actions {
                flex-direction: row;
                gap: 20px;
            }
        }
        
        .company-selector-report {
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .company-selector-report {
                width: 300px;
            }
        }
        
        /* ======= تحسينات خاصة للهواتف ======= */
        
        /* تحسينات للهواتف المحمولة */
        @media (max-width: 768px) {
            .main-header {
                padding: 20px 15px;
            }
            
            .logo-circle {
                width: 70px;
                height: 70px;
                font-size: 32px;
            }
            
            .logo-text h1 {
                font-size: 2rem;
            }
            
            .system-name {
                font-size: 1.7rem;
            }
            
            .table-container {
                margin: 0 -15px;
                width: calc(100% + 30px);
                border-radius: 0;
                border-left: none;
                border-right: none;
                max-height: 500px;
            }
            
            /* تحسين جدول كشف الحساب للهواتف */
            #transactions-table {
                min-width: 750px;
                font-size: 0.82rem;
            }
            
            #transactions-table th,
            #transactions-table td {
                padding: 12px 8px;
                white-space: nowrap;
            }
            
             /* إخفاء بعض الأعمدة على الهواتف لتحسين القراءة */
            #transactions-table th:nth-child(7), /* الرحلة */
            #transactions-table td:nth-child(7),
            #transactions-table th:nth-child(8), /* السبب */
            #transactions-table td:nth-child(8) {
                display: none;
            }
            
            /* تكبير الأعمدة المهمة على الهواتف */
            #transactions-table th:nth-child(2), /* التاريخ */
            #transactions-table td:nth-child(2) {
                min-width: 80px;
            }
            
            #transactions-table th:nth-child(3), /* النوع */
            #transactions-table td:nth-child(3) {
                min-width: 70px;
            }
            
            #transactions-table th:nth-child(4), /* المسافر */
            #transactions-table td:nth-child(4) {
                min-width: 120px;
                max-width: 140px;
            }
            
            #transactions-table th:nth-child(5), /* المستند */
            #transactions-table td:nth-child(5) {
                min-width: 100px;
                max-width: 110px;
            }
            
            #transactions-table th:nth-child(6), /* الوجهة */
            #transactions-table td:nth-child(6) {
                min-width: 90px;
                max-width: 100px;
            }
            
            #transactions-table th:nth-child(9), /* المبلغ */
            #transactions-table td:nth-child(9) {
                min-width: 90px;
            }
            
            #transactions-table th:nth-child(10), /* الرصيد */
            #transactions-table td:nth-child(10) {
                min-width: 90px;
            }
            
            /* تحسين عرض الاسم ورقم المستند على الهواتف */
            #transactions-table td:nth-child(4),
            #transactions-table td:nth-child(5) {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            /* تقليل حجم الوجهة والسبب على الهواتف */
            #transactions-table td:nth-child(6) {
                max-width: 100px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                font-size: 0.8rem;
            }
            
            /* تحسين عرض السبب عند عرضه */
            #transactions-table td:nth-child(8) {
                max-width: 100px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                font-size: 0.8rem;
            }
            
            /* تعديل عرض التبويبات للهواتف */
            .tab {
                padding: 18px 12px;
                font-size: 1rem;
            }
            
            /* تحسين الملخص تحت الجدول للهواتف */
            .summary-items {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .summary-item {
                padding: 15px;
            }
            
            .summary-item .value {
                font-size: 1.5rem;
            }
            
            /* تحسين منطقة معلومات الشركة للهواتف */
            .company-info {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }
            
            .company-info h3 {
                text-align: right;
                font-size: 1.5rem;
                width: 100%;
            }
            
            .company-balance {
                width: 100%;
                text-align: center;
                font-size: 1.5rem;
                margin-top: 15px;
                padding: 15px;
            }
            
            /* تحسين خيارات الراديو للهواتف */
            .radio-group {
                flex-direction: column;
            }
            
            .radio-option {
                justify-content: flex-start;
                padding: 18px;
            }
            
            /* تحسين عرض الجدول للإدارة للهواتف */
            #manage-transactions-table {
                min-width: 700px;
                font-size: 0.82rem;
            }
            
            #manage-transactions-table th,
            #manage-transactions-table td {
                padding: 12px 8px;
            }
            
            /* تحسين الأزرار في جدول الإدارة للهواتف */
            .action-buttons {
                flex-direction: column;
                gap: 8px;
                min-width: 120px;
            }
            
            .action-btn {
                padding: 12px 15px;
                font-size: 0.8rem;
            }
            
            /* إظهار مؤشر التمرير للهواتف */
            .scroll-indicator {
                display: block;
            }
            
            /* تحسين التقرير على الهواتف */
            .report-section {
                padding: 20px 15px;
            }
            
            .report-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .company-report-title {
                font-size: 1.6rem;
                text-align: center;
            }
            
            .btn-print {
                width: 100%;
                padding: 16px;
            }
            
            /* تحسين شريط التمرير للهواتف */
            .table-container::-webkit-scrollbar {
                height: 8px;
            }
            
            .table-container::-webkit-scrollbar-track {
                background: #F0F4FF;
                border-radius: 10px;
                margin: 0 15px;
            }
            
            .table-container::-webkit-scrollbar-thumb {
                background: var(--gradient-primary);
                border-radius: 10px;
            }
            
            /* تحسين فلاتر إدارة العمليات للهواتف */
            .filter-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .filter-group {
                width: 100%;
            }
            
            #reset-filters {
                width: 100%;
                margin-top: 0;
            }
        }
        
        /* تحسينات إضافية للهواتف الصغيرة جداً */
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .main-header {
                padding: 15px 12px;
            }
            
            .header-content {
                gap: 15px;
            }
            
            .logo-circle {
                width: 60px;
                height: 60px;
                font-size: 28px;
            }
            
            .logo-text h1 {
                font-size: 1.7rem;
            }
            
            .system-name {
                font-size: 1.5rem;
            }
            
            /* إخفاء المزيد من الأعمدة في كشف الحساب للهواتف الصغيرة */
            #transactions-table th:nth-child(2), /* التاريخ */
            #transactions-table td:nth-child(2) {
                display: none;
            }
            
            /* إظهار العناصر المهمة فقط */
            #transactions-table {
                min-width: 650px;
                font-size: 0.8rem;
            }
            
            #transactions-table th,
            #transactions-table td {
                padding: 10px 6px;
            }
            
            /* تحسين الملخص تحت الجدول للهواتف الصغيرة */
            .summary-items {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .summary-item {
                padding: 15px;
            }
            
            .summary-item .value {
                font-size: 1.8rem;
            }
            
            /* تحسين التبويبات للهواتف الصغيرة */
            .tabs {
                flex-direction: column;
                border-radius: var(--border-radius);
                overflow: hidden;
            }
            
            .tab {
                border-bottom: 2px solid #E0E0FF;
                border-right: 4px solid transparent;
                padding: 20px;
                text-align: right;
            }
            
            .tab.active {
                border-bottom: 2px solid #E0E0FF;
                border-right: 4px solid var(--accent-color);
                background-color: rgba(74, 0, 224, 0.05);
            }
            
            /* تحسين منطقة إضافة عملية للهواتف الصغيرة */
            .form-section {
                padding: 20px 15px;
            }
            
            h2 {
                font-size: 1.5rem;
                flex-direction: column;
                align-items: flex-start;
            }
            
            h2 span {
                margin-top: 8px;
                font-size: 1rem;
            }
            
            /* تحسين الأزرار للهواتف الصغيرة */
            .btn {
                padding: 18px 20px;
                font-size: 1.1rem;
                margin-top: 15px;
            }
            
            /* تحسين مربع الشركة للهواتف الصغيرة */
            .company-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .company-item-actions {
                width: 100%;
            }
            
            .delete-company {
                width: 100%;
                padding: 12px;
            }
            
            /* تحسين مؤشر التمرير للهواتف الصغيرة */
            .scroll-indicator {
                font-size: 0.7rem;
                padding: 6px 12px;
                right: 8px;
            }
            
            /* تحسين عرض الشركة الحالية للهواتف الصغيرة */
            .company-info h3 {
                font-size: 1.4rem;
            }
            
            .company-balance {
                font-size: 1.5rem;
            }
            
            /* تحسين النافذة المنبثقة للهواتف الصغيرة */
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            
            .modal-header h3 {
                font-size: 1.5rem;
            }
        }
        
        /* تحسينات للأجهزة اللوحية */
        @media (min-width: 769px) and (max-width: 1024px) {
            #transactions-table {
                min-width: 950px;
                font-size: 0.9rem;
            }
            
            #transactions-table th,
            #transactions-table td {
                padding: 14px 10px;
            }
            
            /* إخفاء بعض الأعمدة على الأجهزة اللوحية لتحسين القراءة */
            #transactions-table th:nth-child(7), /* الرحلة */
            #transactions-table td:nth-child(7),
            #transactions-table th:nth-child(8), /* السبب */
            #transactions-table td:nth-child(8) {
                display: none;
            }
        }
        
        /* عناصر الطباعة المخفية */
        .print-page,
        .print-header,
        .print-logo,
        .print-logo-icon,
        .print-title,
        .print-company-info,
        .print-table-container,
        .print-balance-summary,
        .print-footer,
        .print-signature {
            display: none;
        }
        
        /* مؤشر النوع النشط */
        .active-type-indicator {
            background: linear-gradient(135deg, rgba(74, 0, 224, 0.05), rgba(142, 45, 226, 0.05));
            padding: 20px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 25px;
            border-right: 4px solid var(--accent-color);
            animation: slideInRight 0.5s ease-out;
        }
        
        .active-type-header {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .active-type-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 10px 25px rgba(74, 0, 224, 0.2);
        }
        
        .active-type-text h3 {
            margin: 0 0 8px 0;
            color: var(--primary-color);
            font-size: 1.4rem;
        }
        
        .active-type-text p {
            margin: 0;
            color: #666;
        }
        
        /* فلتر التحكم */
        .filter-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        /* رسالة عدم وجود بيانات */
        #no-data, #no-transactions {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #F8F9FF, #F0F4FF);
            border-radius: var(--border-radius);
            border: 2px dashed #E0E0FF;
        }
        
        /* تنسيق النموذج في الإدارة */
        .edit-form {
            background: linear-gradient(135deg, #F8F9FF, #F0F4FF);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border: 2px solid rgba(74, 0, 224, 0.1);
            box-shadow: var(--shadow-light);
        }
        
        .edit-form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .confirm-delete {
            background: linear-gradient(135deg, #FFF5F5, #FFE5E5);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border: 2px solid rgba(255, 65, 108, 0.2);
            box-shadow: var(--shadow-light);
        }
        
        .confirm-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* مؤشر التحميل */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(74, 0, 224, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- خلفية متحركة -->
    <div class="bg-animation">
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
    </div>
    
    <!-- عناصر الطباعة المخفية -->
    <div class="print-page">
        <div class="print-header">
            <div class="print-logo">
                <div class="print-logo-icon">
                    <i class="fas fa-plane"></i>
                </div>
                <div class="print-title">
                    <h1>TAREK Tickets</h1>
                    <p>@tro8qa</p>
                </div>
            </div>
        </div>
        
        <div class="print-company-info">
            <h2 class="print-company-name" id="print-company-name">كشف الحساب</h2>
            <div class="print-company-details">
                <p>تاريخ الطباعة: <span id="current-print-date"></span></p>
                <p id="print-company-balance-info"><span id="print-current-balance"></span></p>
            </div>
        </div>
        
        <!-- جدول الطباعة -->
        <div class="print-table-container">
            <table id="print-transactions-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th style="width: 12%;">التاريخ</th>
                        <th style="width: 15%;">المسافر</th>
                        <th style="width: 12%;">المستند</th>
                        <th style="width: 15%;">المبلغ</th>
                        <th style="width: 15%;">الاجمالي</th>
                    </tr>
                </thead>
                <tbody id="print-transactions-body">
                    <!-- البيانات ستنسخ هنا -->
                </tbody>
            </table>
        </div>
        
        <!-- قسم الرصيد النهائي في الطباعة -->
        <div class="print-balance-summary" id="print-balance-summary">
    <div class="print-total-balance">
        الرصيد النهائي: <span id="print-summary-balance">0 دينار</span>
    </div>
</div>
        
        <div class="print-footer">
            <p>TARE Tickets &copy; 2023</p>
            <p>@rto8qa</p>
            <p>طارق الطيف للبرمجيات</p>
            <p>  </p>
            <div class="print-signature">
                <div class="signature-line"></div>
                <div class="signature-label">التوقيع والختم</div>
            </div>
        </div>
    </div>
    
    <!-- ترويسة جديدة بتصميم عصري -->
    <header class="main-header no-print">
        <div class="header-decoration"></div>
        <div class="header-decoration"></div>
        <div class="header-content">
            <div class="header-logo">
                <div class="logo-circle">
                    <i class="fas fa-plane-departure"></i>
                </div>
                <div class="logo-text">
                    <h1>TAREK Tickets</h1>
                    <p>@tro8qa</p>
                </div>
            </div>
            <div class="header-info">
                <div class="system-name">إدارة تذاكر الطيران الذكية</div>
                <div class="system-description">تتبع العمليات المالية مع شركات الطيران والوكالات</div>
            </div>
        </div>
    </header>
    
    <!-- تبويبات التنقل -->
    <div class="tabs no-print">
        <div class="tab active" data-tab="add">
            <i class="fas fa-plus-circle tab-icon"></i> إضافة عملية
        </div>
        <div class="tab" data-tab="report">
            <i class="fas fa-chart-line tab-icon"></i> كشف الحساب
        </div>
        <div class="tab" data-tab="manage">
            <i class="fas fa-cogs tab-icon"></i> إدارة العمليات
        </div>
    </div>
    
    <div class="container">
        <!-- تبويب إضافة عملية -->
        <div class="tab-content form-section active" id="add-tab">
            <h2><i class="fas fa-plus-circle"></i> تسجيل عملية جديدة</h2>
            
            <!-- مؤشر نوع العملية النشط -->
            <div id="active-type-indicator" class="hidden">
                <!-- سيتم تعبئته بواسطة الجافاسكريبت -->
            </div>
            
            <!-- إدارة الشركات -->
            <button class="btn btn-add-company" id="open-add-company-modal">
                <i class="fas fa-plus"></i> إضافة شركة جديدة
            </button>
            
            <div class="company-list" id="company-list">
                <p id="no-companies">لا توجد شركات مضافة بعد</p>
            </div>
            
            <div class="company-selector">
                <label for="company">اختر الشركة</label>
                <select id="company">
                    <option value="">-- اختر الشركة --</option>
                </select>
            </div>
            
            <div class="company-info">
                <div>
                    <h3 id="current-company">--</h3>
                    <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">الرصيد الحالي</p>
                </div>
                <div class="company-balance" id="company-balance">0 دينار</div>
            </div>
            
            <div class="form-group">
                <label>نوع العملية</label>
                <div class="radio-group">
                    <div class="radio-option" id="ticket-option">
                        <i class="fas fa-ticket-alt radio-icon"></i>
                        <input type="radio" id="ticket" name="transaction-type" value="ticket" checked>
                        <label for="ticket" class="radio-text-glow">تذكرة</label>
                        <div class="type-indicator">نشط</div>
                    </div>
                    <div class="radio-option" id="fine-option">
                        <i class="fas fa-exclamation-triangle radio-icon"></i>
                        <input type="radio" id="fine" name="transaction-type" value="fine">
                        <label for="fine" class="radio-text-glow">غرامة</label>
                        <div class="type-indicator">نشط</div>
                    </div>
                    <div class="radio-option" id="payment-option">
                        <i class="fas fa-money-bill-wave radio-icon"></i>
                        <input type="radio" id="payment" name="transaction-type" value="payment">
                        <label for="payment" class="radio-text-glow">تسليم دفعة</label>
                        <div class="type-indicator">نشط</div>
                    </div>
                </div>
            </div>
            
            <!-- حقول التذكرة والغرامة -->
            <div id="ticket-fine-fields">
                <div class="form-group">
                    <label for="passenger-name">اسم المسافر</label>
                    <input type="text" id="passenger-name" placeholder="أدخل اسم المسافر">
                </div>
                
                <div class="form-group">
                    <label for="document-number">رقم المستند</label>
                    <input type="text" id="document-number" placeholder="أدخل رقم المستند">
                </div>
                
                <div class="form-group">
                    <label for="destination">الوجهة</label>
                    <select id="destination">
                        <option value="TIP - IST">(TIP - IST)</option>
                        <option value="other">وجهة أخرى</option>
                    </select>
                    <input type="text" id="other-destination" placeholder="أدخل الوجهة (مثال: TIP - ROM)" class="hidden">
                </div>
                
                <div class="form-group">
                    <label for="trip-type">نوع الرحلة</label>
                    <select id="trip-type">
                        <option value="ذهاب">ذهاب فقط</option>
                        <option value="ذهاب وعودة">ذهاب وعودة</option>
                    </select>
                </div>
            </div>
            
            <!-- حقول الغرامة فقط -->
            <div id="fine-only-fields" class="hidden">
                <div class="form-group">
                    <label for="fine-reason">سبب الغرامة</label>
                    <textarea id="fine-reason" placeholder="أدخل سبب الغرامة" rows="2"></textarea>
                </div>
            </div>
            
            <!-- حقول التسليم -->
            <div id="payment-fields" class="hidden">
                <div class="form-group">
                    <label for="payment-description">وصف الدفعة</label>
                    <input type="text" id="payment-description" placeholder="مثال: تسليم دفعة شهر أكتوبر">
                </div>
            </div>
            
            <!-- حقول مشتركة -->
            <div class="form-group">
                <label for="amount">المبلغ (دينار)</label>
                <input type="number" id="amount" placeholder="أدخل المبلغ" min="0" step="0.01" inputmode="decimal">
            </div>
            
            <div class="form-group">
                <label for="date">تاريخ العملية</label>
                <input type="date" id="date" value="">
            </div>
            
            <div class="form-group" id="notes-group">
                <label for="notes">ملاحظات إضافية</label>
                <input type="text" id="notes" placeholder="ملاحظات (اختياري)">
            </div>
            
            <button class="btn btn-add" id="add-transaction">
                <i class="fas fa-plus"></i> إضافة العملية
            </button>
            
            <button class="btn btn-reset" id="reset-form">
                <i class="fas fa-redo"></i> مسح النموذج
            </button>
        </div>
        
        <!-- تبويب كشف الحساب -->
        <div class="tab-content report-section" id="report-tab">
            <div class="report-header no-print">
                <h2 class="company-report-title" id="report-company-name">كشف الحساب</h2>
                <div class="report-header-actions">
                    <div class="company-selector-report">
                        <select id="report-company" class="no-print">
                            <option value="">-- اختر الشركة --</option>
                        </select>
                    </div>
                    <button class="btn btn-print no-print" id="print-report">
                        <i class="fas fa-print"></i> طباعة الكشف
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <div class="scroll-indicator">← اسحب لرؤية المزيد →</div>
                <table id="transactions-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>التاريخ</th>
                            <th>النوع</th>
                            <th>المسافر</th>
                            <th>المستند</th>
                            <th>الوجهة</th>
                            <th>الرحلة</th>
                            <th>السبب</th>
                            <th>المبلغ</th>
                            <th>الرصيد</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-body">
                        <!-- البيانات ستضاف هنا بواسطة الجافاسكريبت -->
                    </tbody>
                </table>
            </div>
            
            <!-- ملخص تحت الجدول -->
            <div class="summary-below-table no-print" id="summary-below-table">
                <h3><i class="fas fa-chart-bar"></i> ملخص كشف الحساب</h3>
                <div class="summary-items">
                    <div class="summary-item">
                        <h4>عدد التذاكر</h4>
                        <div class="value" id="total-tickets">0</div>
                    </div>
                    <div class="summary-item">
                        <h4>مجموع الغرامات</h4>
                        <div class="value" id="total-fines">0 دينار</div>
                    </div>
                    <div class="summary-item">
                        <h4>مجموع المدفوعات</h4>
                        <div class="value" id="total-payments">0 دينار</div>
                    </div>
                    <div class="summary-item">
                        <h4>الرصيد النهائي</h4>
                        <div class="value" id="total-balance">0 دينار</div>
                    </div>
                </div>
            </div>
            
            <div id="no-data">
                لا توجد عمليات مسجلة بعد. قم بإضافة عمليات جديدة باستخدام النموذج.
            </div>
        </div>
        
        <!-- تبويب إدارة العمليات -->
        <div class="tab-content manage-section" id="manage-tab">
            <h2><i class="fas fa-cog"></i> إدارة العمليات</h2>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="filter-company">تصفية حسب الشركة</label>
                    <select id="filter-company">
                        <option value="">جميع الشركات</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filter-type">تصفية حسب النوع</label>
                    <select id="filter-type">
                        <option value="">جميع الأنواع</option>
                        <option value="ticket">تذكرة</option>
                        <option value="fine">غرامة</option>
                        <option value="payment">تسليم دفعة</option>
                        <option value="initial">رصيد افتتاحي</option>
                    </select>
                </div>
                
                <button class="btn btn-reset" id="reset-filters" style="margin-top: 0;">
                    <i class="fas fa-filter"></i> إعادة التعيين
                </button>
            </div>
            
            <!-- نموذج التعديل -->
            <div id="edit-form-container" class="hidden">
                <div class="edit-form">
                    <h3><i class="fas fa-edit"></i> تعديل العملية</h3>
                    <div class="form-group">
                        <label for="edit-transaction-type">نوع العملية</label>
                        <select id="edit-transaction-type">
                            <option value="ticket">تذكرة</option>
                            <option value="fine">غرامة</option>
                            <option value="payment">تسليم دفعة</option>
                        </select>
                    </div>
                    
                    <div id="edit-ticket-fields">
                        <div class="form-group">
                            <label for="edit-passenger-name">اسم المسافر</label>
                            <input type="text" id="edit-passenger-name" placeholder="اسم المسافر">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-document-number">رقم المستند</label>
                            <input type="text" id="edit-document-number" placeholder="رقم المستند">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-destination">الوجهة</label>
                            <select id="edit-destination">
                                <option value="TIP - IST">(TIP - IST)</option>
                                <option value="other">وجهة أخرى</option>
                            </select>
                            <input type="text" id="edit-other-destination" placeholder="أدخل الوجهة" class="hidden">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-trip-type">نوع الرحلة</label>
                            <select id="edit-trip-type">
                                <option value="ذهاب">ذهاب فقط</option>
                                <option value="ذهاب وعودة">ذهاب وعودة</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="edit-fine-only-fields" class="hidden">
                        <div class="form-group">
                            <label for="edit-fine-reason">سبب الغرامة</label>
                            <textarea id="edit-fine-reason" placeholder="سبب الغرامة" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div id="edit-payment-fields" class="hidden">
                        <div class="form-group">
                            <label for="edit-payment-description">وصف الدفعة</label>
                            <input type="text" id="edit-payment-description" placeholder="وصف الدفعة">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-amount">المبلغ (دينار)</label>
                        <input type="number" id="edit-amount" placeholder="المبلغ" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-date">تاريخ العملية</label>
                        <input type="date" id="edit-date">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-notes">ملاحظات إضافية</label>
                        <input type="text" id="edit-notes" placeholder="ملاحظات">
                    </div>
                    
                    <div class="edit-form-buttons">
                        <button class="btn btn-cancel" id="cancel-edit">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-save" id="save-edit">
                            <i class="fas fa-save"></i> حفظ التعديلات
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- تأكيد الحذف -->
            <div id="delete-confirm-container" class="hidden">
                <div class="confirm-delete">
                    <h4><i class="fas fa-exclamation-triangle"></i> تأكيد الحذف</h4>
                    <p>هل أنت متأكد من حذف هذه العملية؟ هذا الإجراء لا يمكن التراجع عنه.</p>
                    <div class="confirm-buttons">
                        <button class="btn btn-cancel" id="cancel-delete">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-delete" id="confirm-delete">
                            <i class="fas fa-trash"></i> نعم، احذف
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="table-container manage-table-container">
                <div class="scroll-indicator">← اسحب لرؤية المزيد →</div>
                <table id="manage-transactions-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>التاريخ</th>
                            <th>الشركة</th>
                            <th>النوع</th>
                            <th>المسافر</th>
                            <th>المبلغ</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="manage-transactions-body">
                        <!-- البيانات ستضاف هنا بواسطة الجافاسكريبت -->
                    </tbody>
                </table>
            </div>
            
            <div id="no-transactions">
                لا توجد عمليات مسجلة بعد. قم بإضافة عمليات جديدة باستخدام تبويب "إضافة عملية".
            </div>
        </div>
    </div>
    
    <!-- نافذة إضافة شركة جديدة -->
    <div id="add-company-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-building"></i> إضافة شركة جديدة</h3>
                <button class="close-modal" id="close-add-company-modal">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="new-company-name">اسم الشركة</label>
                <input type="text" id="new-company-name" placeholder="أدخل اسم الشركة">
            </div>
            
            <div class="initial-balance-section">
                <label>الرصيد الافتتاحي</label>
                <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">حدد إذا كانت الشركة تحتاج منك أو أنت تحتاج من الشركة</p>
                
                <div class="balance-type">
                    <div class="credit-option" id="credit-option">
                        <i class="fas fa-hand-holding-usd"></i>
                        <div style="margin-top: 8px; font-size: 1rem;">دائن</div>
                        <div style="font-size: 0.85rem; margin-top: 5px;">الشركة تحتاج منك</div>
                    </div>
                    <div class="debit-option" id="debit-option">
                        <i class="fas fa-money-bill-wave"></i>
                        <div style="margin-top: 8px; font-size: 1rem;">مدين</div>
                        <div style="font-size: 0.85rem; margin-top: 5px;">أنت تحتاج من الشركة</div>
                    </div>
                </div>
                
                <div class="balance-explanation">
                    <div id="credit-explanation" class="hidden">
                        <p><strong class="explanation-positive">دائن:</strong> الشركة تحتاج منك مبلغاً (لديك رصيد موجب لدى الشركة)</p>
                    </div>
                    <div id="debit-explanation" class="hidden">
                        <p><strong class="explanation-negative">مدين:</strong> أنت تحتاج من الشركة مبلغاً (لديك رصيد سالب لدى الشركة)</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="initial-balance">المبلغ (دينار)</label>
                    <input type="number" id="initial-balance" placeholder="أدخل المبلغ" min="0" step="0.01" inputmode="decimal">
                </div>
            </div>
            
            <button class="btn btn-add" id="save-new-company">
                <i class="fas fa-save"></i> حفظ الشركة
            </button>
        </div>
    </div>
    
    <footer class="no-print">
        <p>  TAREKTickets &copy; 2023 </p>
       
    </footer>

    <script>
        // بيانات التطبيق - نفس الكود مع الحفاظ على البيانات
        let transactions = [];
        let companies = {};
        
        // حالة التطبيق
        let balanceType = 'credit';
        let initialBalance = 0;
        let currentEditTransactionId = null;
        let currentDeleteTransactionId = null;
        
        // عناصر DOM
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // مؤشر نوع العملية النشط
        const activeTypeIndicator = document.getElementById('active-type-indicator');
        
        // إدارة الشركات
        const openAddCompanyModalBtn = document.getElementById('open-add-company-modal');
        const addCompanyModal = document.getElementById('add-company-modal');
        const closeAddCompanyModalBtn = document.getElementById('close-add-company-modal');
        const saveNewCompanyBtn = document.getElementById('save-new-company');
        
        const newCompanyNameInput = document.getElementById('new-company-name');
        const debitOption = document.getElementById('debit-option');
        const creditOption = document.getElementById('credit-option');
        const debitExplanation = document.getElementById('debit-explanation');
        const creditExplanation = document.getElementById('credit-explanation');
        const initialBalanceInput = document.getElementById('initial-balance');
        
        const companyList = document.getElementById('company-list');
        const noCompaniesMsg = document.getElementById('no-companies');
        const companySelect = document.getElementById('company');
        const reportCompanySelect = document.getElementById('report-company');
        const currentCompanyElement = document.getElementById('current-company');
        const companyBalanceElement = document.getElementById('company-balance');
        const reportCompanyNameElement = document.getElementById('report-company-name');
        const transactionTypeRadios = document.querySelectorAll('input[name="transaction-type"]');
        
        // عناصر الطباعة
        const printPage = document.querySelector('.print-page');
        const printCompanyName = document.getElementById('print-company-name');
        const printCurrentBalance = document.getElementById('print-current-balance');
        const currentPrintDate = document.getElementById('current-print-date');
        const printTransactionsBody = document.getElementById('print-transactions-body');
        const printSummaryBalance = document.getElementById('print-summary-balance');
        
        // عناصر خيارات نوع العملية
        const ticketOption = document.getElementById('ticket-option');
        const fineOption = document.getElementById('fine-option');
        const paymentOption = document.getElementById('payment-option');
        
        // حقول إضافة العملية
        const ticketFineFields = document.getElementById('ticket-fine-fields');
        const fineOnlyFields = document.getElementById('fine-only-fields');
        const passengerNameInput = document.getElementById('passenger-name');
        const documentNumberInput = document.getElementById('document-number');
        const destinationSelect = document.getElementById('destination');
        const otherDestinationInput = document.getElementById('other-destination');
        const tripTypeSelect = document.getElementById('trip-type');
        const fineReasonInput = document.getElementById('fine-reason');
        const paymentFields = document.getElementById('payment-fields');
        const paymentDescriptionInput = document.getElementById('payment-description');
        const amountInput = document.getElementById('amount');
        const dateInput = document.getElementById('date');
        const notesInput = document.getElementById('notes');
        const notesGroup = document.getElementById('notes-group');
        
        // حقول التعديل
        const editFormContainer = document.getElementById('edit-form-container');
        const editTransactionTypeSelect = document.getElementById('edit-transaction-type');
        const editTicketFields = document.getElementById('edit-ticket-fields');
        const editFineOnlyFields = document.getElementById('edit-fine-only-fields');
        const editPaymentFields = document.getElementById('edit-payment-fields');
        const editPassengerNameInput = document.getElementById('edit-passenger-name');
        const editDocumentNumberInput = document.getElementById('edit-document-number');
        const editDestinationSelect = document.getElementById('edit-destination');
        const editOtherDestinationInput = document.getElementById('edit-other-destination');
        const editTripTypeSelect = document.getElementById('edit-trip-type');
        const editFineReasonInput = document.getElementById('edit-fine-reason');
        const editPaymentDescriptionInput = document.getElementById('edit-payment-description');
        const editAmountInput = document.getElementById('edit-amount');
        const editDateInput = document.getElementById('edit-date');
        const editNotesInput = document.getElementById('edit-notes');
        
        // تأكيد الحذف
        const deleteConfirmContainer = document.getElementById('delete-confirm-container');
        
        // فلاتر إدارة العمليات
        const filterCompanySelect = document.getElementById('filter-company');
        const filterTypeSelect = document.getElementById('filter-type');
        const resetFiltersBtn = document.getElementById('reset-filters');
        
        // أزرار
        const addTransactionButton = document.getElementById('add-transaction');
        const resetFormButton = document.getElementById('reset-form');
        const printReportButton = document.getElementById('print-report');
        const cancelEditBtn = document.getElementById('cancel-edit');
        const saveEditBtn = document.getElementById('save-edit');
        const cancelDeleteBtn = document.getElementById('cancel-delete');
        const confirmDeleteBtn = document.getElementById('confirm-delete');
        
        // عناصر التقرير
        const transactionsBody = document.getElementById('transactions-body');
        const manageTransactionsBody = document.getElementById('manage-transactions-body');
        const noDataElement = document.getElementById('no-data');
        const noTransactionsElement = document.getElementById('no-transactions');
        const totalTicketsElement = document.getElementById('total-tickets');
        const totalFinesElement = document.getElementById('total-fines');
        const totalPaymentsElement = document.getElementById('total-payments');
        const totalBalanceElement = document.getElementById('total-balance');
        const summaryBelowTable = document.getElementById('summary-below-table');
        
        // تعيين تاريخ اليوم كتاريخ افتراضي
        const today = new Date().toISOString().split('T')[0];
        dateInput.value = today;
        editDateInput.value = today;
        
        // أحداث التحكم - نفس الوظائف مع تحسينات بصرية
        // التبويبات
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
                
                if (tabId === 'manage') {
                    updateManageTable();
                }
                
                if (tabId === 'report') {
                    updateReport();
                }
                
                if (tabId === 'add') {
                    updateActiveTypeIndicator();
                }
                
                // تحسين العرض للهواتف
                optimizeForMobile();
            });
        });
        
        // إدارة الشركات
        openAddCompanyModalBtn.addEventListener('click', openAddCompanyModal);
        closeAddCompanyModalBtn.addEventListener('click', closeAddCompanyModal);
        saveNewCompanyBtn.addEventListener('click', saveNewCompany);
        
        // أحداث خيارات الرصيد
        debitOption.addEventListener('click', function() {
            selectBalanceType('debit');
        });
        
        creditOption.addEventListener('click', function() {
            selectBalanceType('credit');
        });
        
        // أحداث الحقول
        companySelect.addEventListener('change', function() {
            const companyName = this.value || '--';
            currentCompanyElement.textContent = companyName;
            reportCompanyNameElement.textContent = companyName === '--' ? 'كشف الحساب' : `كشف حساب: ${companyName}`;
            updateCompanyBalance(this.value);
            updateReport();
            optimizeForMobile();
        });
        
        // حدث اختيار الشركة في التقرير
        reportCompanySelect.addEventListener('change', function() {
            updateReport();
        });
        
        destinationSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                otherDestinationInput.classList.remove('hidden');
                otherDestinationInput.focus();
            } else {
                otherDestinationInput.classList.add('hidden');
            }
        });
        
        editDestinationSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                editOtherDestinationInput.classList.remove('hidden');
                editOtherDestinationInput.focus();
            } else {
                editOtherDestinationInput.classList.add('hidden');
            }
        });
        
        // تغيير حقول النموذج حسب نوع العملية
        transactionTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                updateFormFields(this.value);
                updateActiveTypeClasses(this.value);
                updateActiveTypeIndicator();
            });
        });
        
        editTransactionTypeSelect.addEventListener('change', function() {
            updateEditFormFields(this.value);
        });
        
        // فلاتر إدارة العمليات
        filterCompanySelect.addEventListener('change', updateManageTable);
        filterTypeSelect.addEventListener('change', updateManageTable);
        resetFiltersBtn.addEventListener('click', function() {
            filterCompanySelect.value = '';
            filterTypeSelect.value = '';
            updateManageTable();
            this.classList.add('pulse');
            setTimeout(() => this.classList.remove('pulse'), 1000);
        });
        
        // أزرار العمل
        addTransactionButton.addEventListener('click', addTransaction);
        resetFormButton.addEventListener('click', resetForm);
        printReportButton.addEventListener('click', function() {
            preparePrint();
            setTimeout(() => {
                window.print();
                // إعادة إخفاء عناصر الطباعة بعد الطباعة
                setTimeout(() => {
                    printPage.style.display = 'none';
                }, 100);
            }, 500);
        });
        cancelEditBtn.addEventListener('click', cancelEdit);
        saveEditBtn.addEventListener('click', saveEdit);
        cancelDeleteBtn.addEventListener('click', cancelDelete);
        confirmDeleteBtn.addEventListener('click', confirmDelete);
        
        // تحميل البيانات من localStorage
        loadData();
        
        // تحديث واجهة المستخدم
        updateReport();
        updateActiveTypeIndicator();
        updateActiveTypeClasses('ticket'); // تذكرة هي الافتراضية
        
        // دالة تحسين العرض للهواتف
        function optimizeForMobile() {
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // تحسين عرض الوجهة على الهواتف
                document.querySelectorAll('#transactions-table td:nth-child(6)').forEach(td => {
                    const content = td.textContent;
                    if (content.includes('-')) {
                        const parts = content.split('-');
                        if (parts.length >= 2) {
                            td.innerHTML = parts[0].trim();
                            td.title = content; // إضافة تلميح عند التمرير
                        }
                    }
                });
                
                // تحسين عرض السبب/الوصف
                document.querySelectorAll('#transactions-table td:nth-child(8)').forEach(td => {
                    const content = td.textContent;
                    if (content.length > 15) {
                        td.textContent = content.substring(0, 15) + '...';
                        td.title = content; // إضافة تلميح عند التمرير
                    }
                });
                
                // تحسين عرض اسم المسافر
                document.querySelectorAll('#transactions-table td:nth-child(4)').forEach(td => {
                    const content = td.textContent;
                    if (content.length > 12) {
                        td.textContent = content.substring(0, 12) + '...';
                        td.title = content;
                    }
                });
            }
        }
        
        // دالة تحديث فئات النوع النشط
        function updateActiveTypeClasses(activeType) {
            // إزالة جميع الفئات النشطة أولاً
            ticketOption.classList.remove('active-ticket');
            fineOption.classList.remove('active-fine');
            paymentOption.classList.remove('active-payment');
            
            // إضافة الفئة المناسبة
            if (activeType === 'ticket') {
                ticketOption.classList.add('active-ticket');
            } else if (activeType === 'fine') {
                fineOption.classList.add('active-fine');
            } else if (activeType === 'payment') {
                paymentOption.classList.add('active-payment');
            }
        }
        
        // دالة تحديث مؤشر النوع النشط
        function updateActiveTypeIndicator() {
            let activeType = '';
            transactionTypeRadios.forEach(radio => {
                if (radio.checked) activeType = radio.value;
            });
            
            let icon = '';
            let title = '';
            let description = '';
            let className = '';
            
            if (activeType === 'ticket') {
                icon = 'fas fa-ticket-alt';
                title = 'تذكرة';
                description = 'أنت تقوم بتسجيل تذكرة جديدة. الرجاء ملء بيانات المسافر والمستند والوجهة.';
                className = 'active-type-ticket';
            } else if (activeType === 'fine') {
                icon = 'fas fa-exclamation-triangle';
                title = 'غرامة';
                description = 'أنت تقوم بتسجيل غرامة. الرجاء ملء سبب الغرامة وبياناتها.';
                className = 'active-type-fine';
            } else if (activeType === 'payment') {
                icon = 'fas fa-money-bill-wave';
                title = 'تسليم دفعة';
                description = 'أنت تقوم بتسجيل تسليم دفعة للشركة. الرجاء إدخال وصف الدفعة.';
                className = 'active-type-payment';
            }
            
            activeTypeIndicator.innerHTML = `
                <div class="active-type-header ${className}">
                    <div class="active-type-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="active-type-text">
                        <h3>نوع العملية الحالي: ${title}</h3>
                        <p>${description}</p>
                    </div>
                </div>
            `;
            
            activeTypeIndicator.classList.remove('hidden');
        }
        
        // دالة فتح نافذة إضافة شركة
        function openAddCompanyModal() {
            addCompanyModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            newCompanyNameInput.value = '';
            selectBalanceType('credit');
            initialBalanceInput.value = '';
            setTimeout(() => newCompanyNameInput.focus(), 100);
        }
        
        // دالة إغلاق نافذة إضافة شركة
        function closeAddCompanyModal() {
            addCompanyModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // دالة اختيار نوع الرصيد
        function selectBalanceType(type) {
            balanceType = type;
            
            if (type === 'debit') {
                debitOption.classList.add('selected');
                creditOption.classList.remove('selected');
                debitExplanation.classList.remove('hidden');
                creditExplanation.classList.add('hidden');
            } else {
                debitOption.classList.remove('selected');
                creditOption.classList.add('selected');
                debitExplanation.classList.add('hidden');
                creditExplanation.classList.remove('hidden');
            }
        }
        
        // دالة حفظ شركة جديدة
        function saveNewCompany() {
            const companyName = newCompanyNameInput.value.trim();
            const balance = parseFloat(initialBalanceInput.value) || 0;
            
            if (companyName === '') {
                alert('يرجى إدخال اسم الشركة');
                newCompanyNameInput.focus();
                return;
            }
            
            if (companies.hasOwnProperty(companyName)) {
                alert('هذه الشركة موجودة مسبقاً');
                return;
            }
            
            let openingBalance = balance;
            if (balanceType === 'debit') {
                openingBalance = -balance;
            }
            
            companies[companyName] = openingBalance;
            
            if (balance > 0) {
                const transaction = {
                    id: generateId(),
                    date: today,
                    type: 'initial',
                    company: companyName,
                    amount: balance,
                    description: `رصيد افتتاحي ${balanceType === 'credit' ? 'دائن (الشركة تحتاج مني)' : 'مدين (أحتاج من الشركة)'}`
                };
                
                transactions.push(transaction);
            }
            
            updateCompanyList();
            updateCompanySelect();
            updateReportCompanySelect();
            updateFilterCompanySelect();
            
            companySelect.value = companyName;
            currentCompanyElement.textContent = companyName;
            reportCompanyNameElement.textContent = `كشف حساب: ${companyName}`;
            updateCompanyBalance(companyName);
            
            closeAddCompanyModal();
            saveData();
            
            updateReport();
            updateManageTable();
            optimizeForMobile();
            
            alert('تم إضافة الشركة بنجاح!');
        }
        
        // دالة تحديث حقول النموذج حسب نوع العملية
        function updateFormFields(transactionType) {
            ticketFineFields.classList.add('hidden');
            fineOnlyFields.classList.add('hidden');
            paymentFields.classList.add('hidden');
            
            if (transactionType === 'ticket') {
                ticketFineFields.classList.remove('hidden');
                fineOnlyFields.classList.add('hidden');
                notesGroup.classList.remove('hidden');
            } else if (transactionType === 'fine') {
                ticketFineFields.classList.remove('hidden');
                fineOnlyFields.classList.remove('hidden');
                notesGroup.classList.add('hidden');
            } else if (transactionType === 'payment') {
                paymentFields.classList.remove('hidden');
                notesGroup.classList.add('hidden');
            }
        }
        
        // دالة تحديث حقول نموذج التعديل
        function updateEditFormFields(transactionType) {
            editTicketFields.classList.add('hidden');
            editFineOnlyFields.classList.add('hidden');
            editPaymentFields.classList.add('hidden');
            
            if (transactionType === 'ticket') {
                editTicketFields.classList.remove('hidden');
                editFineOnlyFields.classList.add('hidden');
            } else if (transactionType === 'fine') {
                editTicketFields.classList.remove('hidden');
                editFineOnlyFields.classList.remove('hidden');
            } else if (transactionType === 'payment') {
                editPaymentFields.classList.remove('hidden');
            }
        }
        
        // دالة إضافة عملية جديدة
        function addTransaction() {
            const company = companySelect.value;
            if (!company) {
                alert('يرجى اختيار شركة أولاً');
                companySelect.focus();
                return;
            }
            
            if (!validateForm()) {
                return;
            }
            
            let transactionType = '';
            transactionTypeRadios.forEach(radio => {
                if (radio.checked) transactionType = radio.value;
            });
            
            const transaction = {
                id: generateId(),
                date: dateInput.value,
                type: transactionType,
                company: company,
                amount: parseFloat(amountInput.value)
            };
            
            if (transactionType === 'ticket') {
                let destination = destinationSelect.value;
                if (destination === 'other') {
                    destination = otherDestinationInput.value.trim();
                    if (destination === '') {
                        alert('يرجى إدخال الوجهة');
                        otherDestinationInput.focus();
                        return;
                    }
                }
                
                transaction.passengerName = passengerNameInput.value.trim();
                transaction.documentNumber = documentNumberInput.value.trim();
                transaction.destination = destination;
                transaction.tripType = tripTypeSelect.value;
                transaction.notes = notesInput.value.trim();
                
                if (transaction.passengerName === '') {
                    alert('يرجى إدخال اسم المسافر للتذكرة');
                    passengerNameInput.focus();
                    return;
                }
                
                if (transaction.documentNumber === '') {
                    alert('يرجى إدخال رقم المستند للتذكرة');
                    documentNumberInput.focus();
                    return;
                }
                
            } else if (transactionType === 'fine') {
                transaction.passengerName = passengerNameInput.value.trim();
                transaction.documentNumber = documentNumberInput.value.trim();
                transaction.destination = destinationSelect.value;
                transaction.tripType = tripTypeSelect.value;
                transaction.reason = fineReasonInput.value.trim();
                
                if (transaction.reason === '') {
                    alert('يرجى إدخال سبب الغرامة');
                    fineReasonInput.focus();
                    return;
                }
                
            } else if (transactionType === 'payment') {
                transaction.description = paymentDescriptionInput.value.trim();
                
                if (transaction.description === '') {
                    alert('يرجى إدخال وصف الدفعة');
                    paymentDescriptionInput.focus();
                    return;
                }
            }
            
            updateCompanyBalanceAfterTransaction(company, transaction.type, transaction.amount);
            
            transactions.push(transaction);
            
            saveData();
            
            updateReport();
            updateCompanyList();
            updateManageTable();
            optimizeForMobile();
            
            resetForm();
            
            alert('تم إضافة العملية بنجاح!');
        }
        
        // دالة التحقق من صحة البيانات
        function validateForm() {
            if (amountInput.value === '' || parseFloat(amountInput.value) <= 0) {
                alert('يرجى إدخال مبلغ صحيح أكبر من صفر');
                amountInput.focus();
                return false;
            }
            
            return true;
        }
        
        // دالة تحديث رصيد الشركة بعد العملية
        function updateCompanyBalanceAfterTransaction(company, type, amount) {
            if (type === 'ticket' || type === 'fine') {
                companies[company] += amount;
            } else if (type === 'payment') {
                companies[company] -= amount;
            }
        }
        
        // دالة تحديث عرض رصيد الشركة
        function updateCompanyBalance(company) {
            if (!company) {
                companyBalanceElement.textContent = '0 دينار';
                companyBalanceElement.className = 'company-balance';
                return;
            }
            
            let balance = companies[company] || 0;
            let balanceText = formatCurrency(Math.abs(balance));
            
            if (balance > 0) {
                companyBalanceElement.className = 'company-balance positive-balance';
                companyBalanceElement.textContent = balanceText + ' (دائن)';
            } else if (balance < 0) {
                companyBalanceElement.className = 'company-balance negative-balance';
                companyBalanceElement.textContent = balanceText + ' (مدين)';
            } else {
                companyBalanceElement.className = 'company-balance';
                companyBalanceElement.textContent = balanceText;
            }
        }
        
        // دالة تحديث قائمة الشركات
        function updateCompanyList() {
            if (Object.keys(companies).length === 0) {
                noCompaniesMsg.style.display = 'block';
                companyList.innerHTML = '<p id="no-companies">لا توجد شركات مضافة بعد</p>';
                return;
            }
            
            noCompaniesMsg.style.display = 'none';
            companyList.innerHTML = '';
            
            Object.keys(companies).sort().forEach(company => {
                const companyItem = document.createElement('div');
                companyItem.className = 'company-item';
                
                const balance = companies[company];
                let balanceText = formatCurrency(Math.abs(balance));
                
                if (balance > 0) {
                    balanceText += ' (دائن)';
                } else if (balance < 0) {
                    balanceText += ' (مدين)';
                }
                
                const balanceClass = balance > 0 ? 'positive-balance' : (balance < 0 ? 'negative-balance' : '');
                
                companyItem.innerHTML = `
                    <div class="company-name">${company}</div>
                    <div class="company-item-balance ${balanceClass}">${balanceText}</div>
                    <div class="company-item-actions">
                        <button class="delete-company" data-company="${company}">حذف</button>
                    </div>
                `;
                
                companyList.appendChild(companyItem);
            });
            
            document.querySelectorAll('.delete-company').forEach(btn => {
                btn.addEventListener('click', function() {
                    const companyToDelete = this.getAttribute('data-company');
                    deleteCompany(companyToDelete);
                });
            });
        }
        
        // دالة حذف شركة
        function deleteCompany(companyName) {
            if (!confirm(`هل أنت متأكد من حذف شركة "${companyName}"؟ سيتم حذف جميع عملياتها أيضاً.`)) {
                return;
            }
            
            delete companies[companyName];
            transactions = transactions.filter(t => t.company !== companyName);
            
            updateCompanyList();
            updateCompanySelect();
            updateReportCompanySelect();
            updateFilterCompanySelect();
            updateReport();
            updateManageTable();
            saveData();
            optimizeForMobile();
            
            alert('تم حذف الشركة وعملياتها بنجاح!');
        }
        
        // دالة تحديث قائمة الشركات في select
        function updateCompanySelect() {
            const currentValue = companySelect.value;
            
            companySelect.innerHTML = '<option value="">-- اختر الشركة --</option>';
            
            Object.keys(companies).sort().forEach(company => {
                const option = document.createElement('option');
                option.value = company;
                option.textContent = company;
                companySelect.appendChild(option);
            });
            
            if (currentValue && companies.hasOwnProperty(currentValue)) {
                companySelect.value = currentValue;
            }
        }
        
        // دالة تحديث قائمة الشركات في select التقرير
        function updateReportCompanySelect() {
            const currentValue = reportCompanySelect.value;
            
            reportCompanySelect.innerHTML = '<option value="">-- اختر الشركة --</option>';
            
            Object.keys(companies).sort().forEach(company => {
                const option = document.createElement('option');
                option.value = company;
                option.textContent = company;
                reportCompanySelect.appendChild(option);
            });
            
            if (currentValue && companies.hasOwnProperty(currentValue)) {
                reportCompanySelect.value = currentValue;
            }
        }
        
        // دالة تحديث قائمة الشركات في فلتر إدارة العمليات
        function updateFilterCompanySelect() {
            filterCompanySelect.innerHTML = '<option value="">جميع الشركات</option>';
            
            Object.keys(companies).sort().forEach(company => {
                const option = document.createElement('option');
                option.value = company;
                option.textContent = company;
                filterCompanySelect.appendChild(option);
            });
        }
        
        // دالة فتح نموذج التعديل
        function openEditForm(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            currentEditTransactionId = transactionId;
            
            editFormContainer.classList.remove('hidden');
            deleteConfirmContainer.classList.add('hidden');
            
            editTransactionTypeSelect.value = transaction.type;
            updateEditFormFields(transaction.type);
            
            if (transaction.type === 'ticket') {
                editPassengerNameInput.value = transaction.passengerName || '';
                editDocumentNumberInput.value = transaction.documentNumber || '';
                editDestinationSelect.value = transaction.destination || 'TIP - IST';
                editTripTypeSelect.value = transaction.tripType || 'ذهاب';
                editNotesInput.value = transaction.notes || '';
            } else if (transaction.type === 'fine') {
                editPassengerNameInput.value = transaction.passengerName || '';
                editDocumentNumberInput.value = transaction.documentNumber || '';
                editDestinationSelect.value = transaction.destination || 'TIP - IST';
                editTripTypeSelect.value = transaction.tripType || 'ذهاب';
                editFineReasonInput.value = transaction.reason || '';
            } else if (transaction.type === 'payment') {
                editPaymentDescriptionInput.value = transaction.description || '';
            }
            
            editAmountInput.value = transaction.amount;
            editDateInput.value = transaction.date;
            
            editFormContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // دالة إلغاء التعديل
        function cancelEdit() {
            editFormContainer.classList.add('hidden');
            currentEditTransactionId = null;
        }
        
        // دالة حفظ التعديلات
        function saveEdit() {
            if (!currentEditTransactionId) return;
            
            const transactionIndex = transactions.findIndex(t => t.id === currentEditTransactionId);
            if (transactionIndex === -1) return;
            
            const oldTransaction = transactions[transactionIndex];
            const oldAmount = oldTransaction.amount;
            const oldType = oldTransaction.type;
            
            if (oldType === 'ticket' || oldType === 'fine') {
                companies[oldTransaction.company] -= oldAmount;
            } else if (oldType === 'payment') {
                companies[oldTransaction.company] += oldAmount;
            }
            
            const transactionType = editTransactionTypeSelect.value;
            const amount = parseFloat(editAmountInput.value);
            
            if (!amount || amount <= 0) {
                alert('يرجى إدخال مبلغ صحيح أكبر من صفر');
                editAmountInput.focus();
                return;
            }
            
            const updatedTransaction = {
                ...oldTransaction,
                date: editDateInput.value,
                type: transactionType,
                amount: amount
            };
            
            if (transactionType === 'ticket') {
                let destination = editDestinationSelect.value;
                if (destination === 'other') {
                    destination = editOtherDestinationInput.value.trim();
                    if (destination === '') {
                        alert('يرجى إدخال الوجهة');
                        editOtherDestinationInput.focus();
                        return;
                    }
                }
                
                updatedTransaction.passengerName = editPassengerNameInput.value.trim();
                updatedTransaction.documentNumber = editDocumentNumberInput.value.trim();
                updatedTransaction.destination = destination;
                updatedTransaction.tripType = editTripTypeSelect.value;
                updatedTransaction.notes = editNotesInput.value.trim();
                updatedTransaction.reason = '';
                updatedTransaction.description = '';
                
                if (updatedTransaction.passengerName === '') {
                    alert('يرجى إدخال اسم المسافر للتذكرة');
                    editPassengerNameInput.focus();
                    return;
                }
                
                if (updatedTransaction.documentNumber === '') {
                    alert('يرجى إدخال رقم المستند للتذكرة');
                    editDocumentNumberInput.focus();
                    return;
                }
                
            } else if (transactionType === 'fine') {
                updatedTransaction.passengerName = editPassengerNameInput.value.trim();
                updatedTransaction.documentNumber = editDocumentNumberInput.value.trim();
                updatedTransaction.destination = editDestinationSelect.value;
                updatedTransaction.tripType = editTripTypeSelect.value;
                updatedTransaction.reason = editFineReasonInput.value.trim();
                updatedTransaction.notes = '';
                updatedTransaction.description = '';
                
                if (updatedTransaction.reason === '') {
                    alert('يرجى إدخال سبب الغرامة');
                    editFineReasonInput.focus();
                    return;
                }
                
            } else if (transactionType === 'payment') {
                updatedTransaction.description = editPaymentDescriptionInput.value.trim();
                updatedTransaction.passengerName = '';
                updatedTransaction.documentNumber = '';
                updatedTransaction.destination = '';
                updatedTransaction.tripType = '';
                updatedTransaction.reason = '';
                updatedTransaction.notes = '';
                
                if (updatedTransaction.description === '') {
                    alert('يرجى إدخال وصف الدفعة');
                    editPaymentDescriptionInput.focus();
                    return;
                }
            }
            
            if (transactionType === 'ticket' || transactionType === 'fine') {
                companies[updatedTransaction.company] += amount;
            } else if (transactionType === 'payment') {
                companies[updatedTransaction.company] -= amount;
            }
            
            transactions[transactionIndex] = updatedTransaction;
            
            saveData();
            updateReport();
            updateCompanyList();
            updateManageTable();
            optimizeForMobile();
            
            editFormContainer.classList.add('hidden');
            currentEditTransactionId = null;
            
            alert('تم تحديث العملية بنجاح!');
        }
        
        // دالة فتح تأكيد الحذف
        function openDeleteConfirm(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            currentDeleteTransactionId = transactionId;
            
            deleteConfirmContainer.classList.remove('hidden');
            editFormContainer.classList.add('hidden');
            
            deleteConfirmContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // دالة إلغاء الحذف
        function cancelDelete() {
            deleteConfirmContainer.classList.add('hidden');
            currentDeleteTransactionId = null;
        }
        
        // دالة تأكيد الحذف
        function confirmDelete() {
            if (!currentDeleteTransactionId) return;
            
            const transactionIndex = transactions.findIndex(t => t.id === currentDeleteTransactionId);
            if (transactionIndex === -1) return;
            
            const transaction = transactions[transactionIndex];
            
            if (confirm(`هل أنت متأكد من حذف هذه العملية؟\n\nالتفاصيل:\n- الشركة: ${transaction.company}\n- النوع: ${getTypeName(transaction.type)}\n- المبلغ: ${formatCurrency(transaction.amount)}\n\nهذا الإجراء لا يمكن التراجع عنه.`)) {
                if (transaction.type === 'ticket' || transaction.type === 'fine') {
                    companies[transaction.company] -= transaction.amount;
                } else if (transaction.type === 'payment') {
                    companies[transaction.company] += transaction.amount;
                }
                
                transactions.splice(transactionIndex, 1);
                
                saveData();
                updateReport();
                updateCompanyList();
                updateManageTable();
                optimizeForMobile();
                
                deleteConfirmContainer.classList.add('hidden');
                currentDeleteTransactionId = null;
                
                alert('تم حذف العملية بنجاح!');
            }
        }
        
        // دالة تحديث جدول إدارة العمليات
        function updateManageTable() {
            const filterCompany = filterCompanySelect.value;
            const filterType = filterTypeSelect.value;
            
            let filteredTransactions = [...transactions];
            
            if (filterCompany) {
                filteredTransactions = filteredTransactions.filter(t => t.company === filterCompany);
            }
            
            if (filterType) {
                filteredTransactions = filteredTransactions.filter(t => t.type === filterType);
            }
            
            if (filteredTransactions.length > 0) {
                noTransactionsElement.style.display = 'none';
                manageTransactionsBody.innerHTML = '';
            } else {
                noTransactionsElement.style.display = 'block';
                manageTransactionsBody.innerHTML = '';
                return;
            }
            
            filteredTransactions.forEach((transaction, index) => {
                const row = document.createElement('tr');
                row.className = 'transaction-row';
                
                let typeClass = '';
                let typeText = getTypeName(transaction.type);
                
                if (transaction.type === 'ticket') {
                    typeClass = 'transaction-ticket';
                } else if (transaction.type === 'fine') {
                    typeClass = 'transaction-fine';
                } else if (transaction.type === 'payment') {
                    typeClass = 'transaction-payment';
                } else if (transaction.type === 'initial') {
                    typeClass = 'transaction-initial';
                }
                
                let passengerName = transaction.passengerName || transaction.description || '-';
                if (passengerName.length > 20) {
                    passengerName = passengerName.substring(0, 20) + '...';
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${transaction.date}</td>
                    <td>${transaction.company}</td>
                    <td><span class="transaction-type ${typeClass}">${typeText}</span></td>
                    <td>${passengerName}</td>
                    <td>${formatCurrency(transaction.amount)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn action-btn-edit" data-id="${transaction.id}">
                                <i class="fas fa-edit"></i> تعديل
                            </button>
                            <button class="action-btn action-btn-delete" data-id="${transaction.id}">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </td>
                `;
                
                manageTransactionsBody.appendChild(row);
            });
            
            document.querySelectorAll('.action-btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const transactionId = this.getAttribute('data-id');
                    openEditForm(transactionId);
                });
            });
            
            document.querySelectorAll('.action-btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const transactionId = this.getAttribute('data-id');
                    openDeleteConfirm(transactionId);
                });
            });
        }
        
        // دالة تحديث كشف الحساب
        function updateReport() {
            const selectedCompany = reportCompanySelect.value || companySelect.value;
            
            if (selectedCompany) {
                reportCompanyNameElement.textContent = `كشف حساب: ${selectedCompany}`;
                printCompanyName.textContent = `كشف حساب: ${selectedCompany}`;
            } else {
                reportCompanyNameElement.textContent = 'كشف الحساب';
                printCompanyName.textContent = 'كشف الحساب';
            }
            
            updateCompanyBalance(selectedCompany);
            
            if (transactions.length > 0) {
                noDataElement.style.display = 'none';
                summaryBelowTable.style.display = 'block';
                transactionsBody.innerHTML = '';
            } else {
                noDataElement.style.display = 'block';
                summaryBelowTable.style.display = 'none';
                transactionsBody.innerHTML = '';
                updateSummary();
                return;
            }
            
            let filteredTransactions = [];
            let finalBalance = 0;
            
            if (selectedCompany) {
                filteredTransactions = transactions.filter(t => t.company === selectedCompany);
                finalBalance = companies[selectedCompany] || 0;
            } else {
                filteredTransactions = [...transactions];
                finalBalance = Object.values(companies).reduce((sum, balance) => sum + balance, 0);
            }
            
            let runningBalance = 0;
            filteredTransactions.forEach((transaction, index) => {
                if (transaction.type === 'ticket' || transaction.type === 'fine' || transaction.type === 'initial') {
                    runningBalance += transaction.amount;
                } else if (transaction.type === 'payment') {
                    runningBalance -= transaction.amount;
                }
                
                const row = document.createElement('tr');
                
                let typeClass = '';
                let typeText = getTypeName(transaction.type);
                
                if (transaction.type === 'ticket') {
                    typeClass = 'transaction-ticket';
                } else if (transaction.type === 'fine') {
                    typeClass = 'transaction-fine';
                } else if (transaction.type === 'payment') {
                    typeClass = 'transaction-payment';
                } else if (transaction.type === 'initial') {
                    typeClass = 'transaction-initial';
                }
                
                let passengerName = transaction.passengerName || '-';
                let documentNumber = transaction.documentNumber || '-';
                
                let destination = transaction.destination || '-';
                if (destination.includes('(')) {
                    const match = destination.match(/\(([^)]+)\)/);
                    if (match) {
                        destination = `<span class="destination-abbr">${match[1]}</span>`;
                    }
                }
                
                let tripType = transaction.tripType || '-';
                let reasonDesc = transaction.reason || transaction.description || '-';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${transaction.date}</td>
                    <td><span class="transaction-type ${typeClass}">${typeText}</span></td>
                    <td>${passengerName}</td>
                    <td>${documentNumber}</td>
                    <td>${destination}</td>
                    <td>${tripType}</td>
                    <td>${reasonDesc}</td>
                    <td>${formatCurrency(transaction.amount)}</td>
                    <td>${formatCurrency(runningBalance)}</td>
                `;
                
                transactionsBody.appendChild(row);
            });
            
            // إضافة صف الرصيد النهائي في الجدول
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="8">الرصيد النهائي</td>
                <td colspan="2">${formatCurrency(finalBalance)}</td>
            `;
            transactionsBody.appendChild(totalRow);
            
            updateSummary(filteredTransactions, finalBalance);
            optimizeForMobile();
        }
        
        // دالة تحديث الملخص تحت الجدول
        function updateSummary(filteredTransactions = null, finalBalance = 0) {
            const transactionsToCalculate = filteredTransactions || transactions;
            
            let totalTickets = 0;
            let totalFines = 0;
            let totalPayments = 0;
            
            transactionsToCalculate.forEach(transaction => {
                if (transaction.type === 'ticket') {
                    totalTickets++;
                } else if (transaction.type === 'fine') {
                    totalFines += transaction.amount;
                } else if (transaction.type === 'payment') {
                    totalPayments += transaction.amount;
                }
            });
            
            totalTicketsElement.textContent = totalTickets;
            totalFinesElement.textContent = formatCurrency(totalFines);
            totalPaymentsElement.textContent = formatCurrency(totalPayments);
            totalBalanceElement.textContent = formatCurrency(finalBalance);
            
            // تحديث ألوان الرصيد النهائي
            if (finalBalance > 0) {
                totalBalanceElement.className = 'value positive';
            } else if (finalBalance < 0) {
                totalBalanceElement.className = 'value negative';
            } else {
                totalBalanceElement.className = 'value';
            }
        }
        
        // دالة تحديث جدول الطباعة
        function updatePrintTable(filteredTransactions = null, finalBalance = 0) {
            const currentCompany = reportCompanySelect.value || companySelect.value;
            const transactionsToShow = filteredTransactions || transactions.filter(t => !currentCompany || t.company === currentCompany);
            
            printTransactionsBody.innerHTML = '';
            
            if (transactionsToShow.length === 0) {
                return;
            }
            
            let runningBalance = 0;
            transactionsToShow.forEach((transaction, index) => {
                if (transaction.type === 'ticket' || transaction.type === 'fine' || transaction.type === 'initial') {
                    runningBalance += transaction.amount;
                } else if (transaction.type === 'payment') {
                    runningBalance -= transaction.amount;
                }
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${transaction.date}</td>
                    <td>${transaction.passengerName || '-'}</td>
                    <td>${transaction.documentNumber || '-'}</td>
                    <td>${formatCurrency(transaction.amount)}</td>
                    <td>${formatCurrency(runningBalance)}</td>
                `;
                
                printTransactionsBody.appendChild(row);
            });
            
            // تحديث الرصيد النهائي في الطباعة
            printSummaryBalance.textContent = formatCurrency(finalBalance);
            
            // تحديث لون الرصيد النهائي
            if (finalBalance > 0) {
                printSummaryBalance.className = 'positive-balance-print';
            } else if (finalBalance < 0) {
                printSummaryBalance.className = 'negative-balance-print';
            } else {
                printSummaryBalance.className = 'neutral-balance-print';
            }
        }
        
        // دالة إعداد الطباعة
        function preparePrint() {
            // إظهار صفحة الطباعة
            printPage.style.display = 'block';
            
            // تحديث تاريخ الطباعة
            const now = new Date();
            const formattedDate = now.toLocaleDateString('ar-LY', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }) + ' - ' + now.toLocaleTimeString('ar-LY', {
                hour: '2-digit',
                minute: '2-digit'
            });
            currentPrintDate.textContent = formattedDate;
            
            // تحديث الرصيد الحالي
            const currentCompany = reportCompanySelect.value || companySelect.value;
            if (currentCompany) {
                const balance = companies[currentCompany] || 0;
                printCurrentBalance.textContent = formatCurrency(Math.abs(balance)) + (balance > 0 ? ' (دائن)' : balance < 0 ? ' (مدين)' : '');
            } else {
                printCurrentBalance.textContent = '0 دينار';
            }
            
            // تحديث جدول الطباعة
            let filteredTransactions = [];
            let finalBalance = 0;
            
            if (currentCompany) {
                filteredTransactions = transactions.filter(t => t.company === currentCompany);
                finalBalance = companies[currentCompany] || 0;
            } else {
                filteredTransactions = [...transactions];
                finalBalance = Object.values(companies).reduce((sum, balance) => sum + balance, 0);
            }
            
            updatePrintTable(filteredTransactions, finalBalance);
        }
        
        // دالة إعادة تعيين النموذج
        function resetForm() {
            passengerNameInput.value = '';
            documentNumberInput.value = '';
            destinationSelect.value = 'TIP - IST';
            otherDestinationInput.classList.add('hidden');
            otherDestinationInput.value = '';
            tripTypeSelect.value = 'ذهاب';
            
            fineReasonInput.value = '';
            paymentDescriptionInput.value = '';
            
            amountInput.value = '';
            dateInput.value = today;
            notesInput.value = '';
            
            if (companySelect.value) {
                passengerNameInput.focus();
            }
        }
        
        // دالة الحصول على اسم النوع
        function getTypeName(type) {
            switch(type) {
                case 'ticket': return 'تذكرة';
                case 'fine': return 'غرامة';
                case 'payment': return 'تسليم';
                case 'initial': return 'افتتاحي';
                default: return type;
            }
        }
        
        // دالة توليد معرف فريد
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // دالة تنسيق العملة
        function formatCurrency(amount) {
            const absAmount = Math.abs(amount);
            const formatted = new Intl.NumberFormat('ar-LY', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(absAmount) + ' دينار';
            
            if (amount < 0) {
                return '-' + formatted;
            }
            return formatted;
        }
        
        // دالة حفظ البيانات في localStorage
        function saveData() {
            localStorage.setItem('ticketSystem_transactions', JSON.stringify(transactions));
            localStorage.setItem('ticketSystem_companies', JSON.stringify(companies));
        }
        
        // دالة تحميل البيانات من localStorage
        function loadData() {
            const savedTransactions = localStorage.getItem('ticketSystem_transactions');
            const savedCompanies = localStorage.getItem('ticketSystem_companies');
            
            if (savedTransactions) {
                transactions = JSON.parse(savedTransactions);
            }
            
            if (savedCompanies) {
                companies = JSON.parse(savedCompanies);
                updateCompanySelect();
                updateReportCompanySelect();
                updateFilterCompanySelect();
                updateCompanyList();
                optimizeForMobile();
            }
        }
        
        // إغلاق النافذة عند النقر خارجها
        addCompanyModal.addEventListener('click', function(e) {
            if (e.target === addCompanyModal) {
                closeAddCompanyModal();
            }
        });
        
        // اختيار نوع الرصيد الافتراضي
        selectBalanceType('credit');
        
        // إغلاق النافذة بمفتاح ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (!addCompanyModal.classList.contains('hidden')) {
                    closeAddCompanyModal();
                }
                if (editFormContainer.classList.contains('hidden') === false) {
                    cancelEdit();
                }
                if (deleteConfirmContainer.classList.contains('hidden') === false) {
                    cancelDelete();
                }
            }
        });
        
        // تحديث تحسينات الهواتف عند تغيير حجم النافذة
        window.addEventListener('resize', optimizeForMobile);
        
        // تهيئة التحسينات عند تحميل الصفحة
        window.addEventListener('load', function() {
            optimizeForMobile();
            // إضافة تأثيرات عند التحميل
            document.querySelectorAll('.form-section, .report-section, .manage-section').forEach((section, index) => {
                section.style.animationDelay = `${0.1 * index}s`;
            });
        });
        
        // إخفاء عناصر الطباعة بعد الطباعة
        window.addEventListener('afterprint', function() {
            printPage.style.display = 'none';
        });
    </script>
</body>
</html>


